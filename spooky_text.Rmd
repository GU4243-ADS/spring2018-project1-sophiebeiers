---
title: "Spooky Poetry Text Analysis"
author: "Sophie Beiers"
date: "1/27/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Introduction
The goal of this project is to analyze the poetry of three "spooky" poets: H.P. Lovecraft (`HPL`), Mary Shelly (`MWS`), and Edgar Allen Poe (`EAP`). Below, I assess their similarities and differences in semantics, common words and themes and length of poetry. 

#### Libraries Needed
Code by Cindy Rush, Statistics Professor of Columbia University.
```{r, message = F, warning = F}
packages.used <- c("ggplot2", "dplyr", "tibble", "tidyr",  "stringr", "tidytext", "topicmodels", "wordcloud", "ggridges")

# check packages that need to be installed.
packages.needed <- setdiff(packages.used, intersect(installed.packages()[,1], packages.used))

# install additional packages
if(length(packages.needed) > 0) {
  install.packages(packages.needed, dependencies = TRUE, repos = 'http://cran.us.r-project.org')
}

library(ggplot2)
library(dplyr)
library(tibble)
library(tidyr)
library(stringr)
library(tidytext)
library(topicmodels)
library(wordcloud)
library(ggridges)


source("./lib/multiplot.R")
```

### Data & Cleaning
To reproduce, download spooky.csv into your Documents/data folder. 
```{r}
spooky <- read.csv('./data/spooky.csv', as.is = TRUE)
sum(is.na(spooky)) # no NA's in data 
spooky$author <- as.factor(spooky$author) # Make "author" a factor
```

To begin, I'll use TidyText's "unnest_tokens" to format the data into a table with one word per row and the number of times that word appears per author. 
```{r}
spooky_wrd <- spooky %>%
  unnest_tokens(word, text) %>% 
  count(author, word, sort = TRUE) %>% # sorts by most common words
  ungroup()
```

I was first curious to see which authors use certain personal pronouns more than others. 

```{r}
pronouns <- c("i", "we", "us", "they", "them", "he", "she", "you", "him", "her")
spooky_pronouns <- filter(spooky_wrd, word %in% pronouns)

spooky_wrd %>%
  filter(word %in% pronouns) %>%
  ggplot(., aes(x = reorder(word, -n), y = n)) +
  geom_bar(aes(color = author, fill = author), stat = "identity") +
  xlab("Pronouns") +
  ylab("Number of Occurences") +
  theme_light()
```
From the plot, we can see that MWS and EAP tend to talk about themselves more often than HPL. MWS writes about other women (her, she) more frequently than the male authors, perhaps not surprisingly. HPL seems to rarely refer to women in his poetry, though he is also seemingly less likely than the other authors to use pronouns in his writing at all. 


I then added a column to the table spooky_wrd for the total amount of words each author uses in his/her poetry. Next, I get rid of all the "stopwords" (including the pronouns) in the data to make analysis more interesting. 
```{r}
total_wrds <- spooky_wrd %>% 
  group_by(author) %>% 
  summarize(total = sum(n))

spooky_wrd <- left_join(spooky_wrd, total_wrds, by = "author")

spooky_wrd_clean <- spooky_wrd %>% 
  anti_join(stop_words, by = "word") # rids of stopwords

spooky_wrd_clean <- spooky_wrd_clean %>% 
  group_by(author) %>% 
  mutate(rank = row_number(), freq = n/total) # added rank and frequency values
```

### Analysis
#### What is each author's top 10 words used in his/her poetry? 
I created three separate dataframes that represent each author's top ten words used in his/her poems and the proportion of the entire poetry collection that those words make up. I merged together the three sets to create one larger dataframe with all three author's top ten words. 
```{r, message = FALSE, warning = FALSE}
# Top 10 Words Dataframes
MWS_10words <- spooky_wrd_clean %>% 
  filter(author == "MWS") %>%
  mutate(freq = n/total, rank = row_number()) %>% 
  arrange(desc(n)) %>% 
  filter(rank <= 10)

EAP_10words <- spooky_wrd_clean %>% 
  filter(author == "EAP") %>%
  mutate(freq = n/total, rank = row_number()) %>% 
  arrange(desc(n)) %>% 
  filter(rank <= 10)

HPL_10words <- spooky_wrd_clean %>% 
  filter(author == "HPL") %>%
  mutate(freq = n/total, rank = row_number()) %>% 
  arrange(desc(n)) %>% 
  filter(rank <= 10)

top10 <- rbind(HPL_10words, EAP_10words)
top10 <- rbind(top10, MWS_10words)

top10 %>% 
  ggplot(., aes(x = reorder(word, n), y = n)) +
  geom_bar(aes(color = author, fill = author), stat = 'identity') +
  facet_wrap(~author) + 
  coord_flip() +
  theme_light() +
  ylab("Number of Occurences") +
  xlab("Most Common Words")

# Word lists by author
MWSwords <- spooky_wrd_clean %>% 
  filter(author == "MWS") %>%
  mutate(freq = n/total, rank = row_number()) %>% 
  arrange(desc(n))

HPLwords <- spooky_wrd_clean %>% 
  filter(author == "HPL") %>%
  mutate(freq = n/total, rank = row_number()) %>% 
  arrange(desc(n))

EAPwords <- spooky_wrd_clean %>% 
  filter(author == "EAP") %>%
  mutate(freq = n/total, rank = row_number()) %>% 
  arrange(desc(n))

# Word Clouds
# MWS wordcloud
#png("../figs/Workcloud_all.png")
wordcloud(words = MWSwords$word, freq = MWSwords$freq, max.words = 100, 
                  random.order = FALSE, rot.per = 0.35, colors = brewer.pal(6, "Dark2"), main = "hi")

# HPL wordcloud
wordcloud(words = HPLwords$word, freq = HPLwords$freq, max.words = 100, 
                  random.order = FALSE, rot.per = 0.35, colors = brewer.pal(6, "Dark2"))

# EAP wordcloud
wordcloud(words = EAPwords$word, freq = EAPwords$freq, max.words = 100, 
                  random.order = FALSE, rot.per = 0.35, colors = brewer.pal(6, "Dark2"))
#dev.off()

#layout <- matrix(c(1, 2, 3), 1, 3, byrow = TRUE)
#multiplot(MWSwc, HPLwc, EAPwc, layout = layout)
```

Some of the authors' top ten most common words overlap; all three authors like to write about "time" and "day." We can also see, however, that the two male authors EAP and HPL have slightly more overlapping top words than with MWS. Both male authors frequently use the words "night" and "found." Other than the words all three authors have in common, EAP overlaps with MWS on the word "eyes" and HPL doesn't overlap with MWS at all. Given that MWS's top three words used are "life," "love," and "heart," we may assume that the content of MWS's work might be more emotional in nature compared to her male counterparts. Her frequent use of the name "Raymond" may be from her work "The Last Man."

### Sentiment 
"Life," "love" and "heart" all seem like quite positively associated words. Given all three authors have a known tendency toward spooky writing, I wanted to assess 

